# 图片水印工具 PRD

## 一、背景与目标
用户希望通过图形界面工具，为图片添加自定义水印，便于图片管理、版权保护和溯源。工具需支持多种水印样式和布局选项，提供友好的用户界面和批量处理能力。

## 二、功能需求

### 1. 文件处理
#### 1.1 导入图片
- 支持单张图片拖拽或通过文件选择器导入。
- 支持批量导入，可一次性选择多张图片或直接导入整个文件夹。
- 在界面上显示已导入图片的列表（缩略图和文件名）。

#### 1.2 支持格式
- 输入格式：必须支持主流格式，如 JPEG, PNG。强烈建议支持 BMP, TIFF。PNG格式必须支持透明通道。
- 输出格式：用户可选择输出为 JPEG 或 PNG。

#### 1.3 导出图片
- 用户可指定一个输出文件夹。为防止覆盖原图，默认禁止导出到原文件夹。
- 提供导出文件命名规则选项：
  - 保留原文件名。
  - 添加自定义前缀（如 wm_）。
  - 添加自定义后缀（如 _watermarked）。
- 对于 JPEG 格式，提供图片质量（压缩率）调节滑块（0-100）。（可选高级功能）
- 导出时允许用户调整图片尺寸（如按宽度、高度或百分比缩放）。（可选高级功能）

### 2. 水印类型
#### 2.1 文本水印
- 内容：用户可自定义输入任意文本。
- 字体：可选择系统已安装的字体、字号、粗体、斜体。（可选高级功能）
- 颜色：提供调色板让用户选择字体颜色。（可选高级功能）
- 透明度：可调节文本的透明度（0-100%）。
- 样式：可添加阴影或描边效果，以增强在复杂背景下的可读性。（可选高级功能）

#### 2.2 图片水印（可选高级功能）
- 用户可从本地选择一张图片（如Logo）作为水印。
- 必须支持带透明通道的 PNG 图片。
- 缩放：可按比例或自由调整图片水印的大小。
- 透明度：可调节图片水印的整体透明度（0-100%）。

### 3. 水印布局与样式
#### 3.1 实时预览
- 所有对水印的调整都应在主预览窗口中实时显示效果。
- 用户可以点击图片列表切换预览不同的图片。

#### 3.2 位置
- 预设位置：提供九宫格布局（四角、正中心），用户可一键将水印放置在这些位置。
- 手动拖拽：用户可以直接在预览图上通过鼠标拖拽水印到任意位置。

#### 3.3 旋转
- 提供一个滑块或输入框，允许用户以任意角度旋转水印。（可选高级功能）

### 4. 配置管理
#### 4.1 水印模板
- 用户可以将当前的水印设置（包括水印内容、字体、颜色、位置、大小、透明度等所有参数）保存为一个模板。
- 用户可以加载、管理和删除已保存的模板。
- 程序启动时可自动加载上一次关闭时的设置或一个默认模板。

### 5. EXIF功能
- 程序可自动读取图片的EXIF拍摄时间（年月日），作为水印内容选项。
- 用户可设置水印字体大小、颜色和位置。

## 三、技术规格

### 3.1 开发环境
- **编程语言**: Python 3.6
- **GUI框架**: tkinter (Python标准库)
- **图像处理**: Pillow (PIL) 5.4.0+
- **EXIF处理**: exifread 2.3.2+
- **其他依赖**: 详见requirements.txt

### 3.2 系统兼容性
- Windows 7/10/11 (Python 3.6+)
- macOS 10.12+ (Python 3.6+)
- Linux (Ubuntu 16.04+, CentOS 7+)

### 3.3 性能要求
- 单张图片处理时间 < 3秒 (2MB以内)
- 批量处理支持队列机制，避免内存溢出
- 支持最大图片尺寸: 50MB
- 内存占用 < 500MB (处理10张图片时)

## 四、非功能需求
- 兼容主流操作系统（Windows/macOS/Linux）。
- 依赖安装简单，文档完善。
- 处理速度快，支持批量。
- 界面友好，操作直观。
- 资源占用合理，不应过度消耗系统资源。

## 五、交互流程
1. 用户启动程序，显示主界面。
2. 用户导入图片（单张或批量）。
3. 用户设置水印类型、内容、样式和位置。
4. 用户在预览窗口中查看效果并进行调整。
5. 用户选择输出设置并导出处理后的图片。

## 六、异常场景
- 图片无EXIF拍摄时间：提示用户并提供替代选项。
- 导入不支持的文件格式：提示用户并跳过。
- 输出路径不可写：提示用户选择其他路径。
- 内存不足：优化处理大图片的方式，必要时提示用户。

## 七、扩展建议
- 支持批处理模式，允许用户保存处理配置并应用于未来的批处理任务。
- 支持更多水印样式和特效。
- 支持多语言界面。
- 提供命令行接口，方便高级用户和自动化脚本使用。
